"use strict";(globalThis.webpackChunksoft_kitty_docs=globalThis.webpackChunksoft_kitty_docs||[]).push([[3669],{1437(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"master-inventory-engine/callbacks","title":"Callbacks","description":"ItemChangeCallback","source":"@site/docs/master-inventory-engine/callbacks.md","sourceDirName":"master-inventory-engine","slug":"/master-inventory-engine/callbacks","permalink":"/docs/master-inventory-engine/callbacks","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Callbacks"},"sidebar":"docs","previous":{"title":"WindowsManager.cs","permalink":"/docs/master-inventory-engine/ui/windows-manager"},"next":{"title":"Modding Support","permalink":"/docs/master-inventory-engine/expansions/modding-support"}}');var a=r(4848),i=r(8453);const l={title:"Callbacks"},s=void 0,c={},o=[{value:"ItemChangeCallback",id:"itemchangecallback",level:3},{value:"TO REGISTER THIS CALLBACK:",id:"to-register-this-callback",level:5},{value:"ItemDropCallback",id:"itemdropcallback",level:3},{value:"TO REGISTER THIS CALLBACK:",id:"to-register-this-callback-1",level:5},{value:"ItemUseCallback",id:"itemusecallback",level:3},{value:"TO REGISTER THIS CALLBACK:",id:"to-register-this-callback-2",level:5}];function d(e){const n={a:"a",code:"code",h3:"h3",h5:"h5",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h3,{id:"itemchangecallback",children:"ItemChangeCallback"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:"public delegate void ItemChangeCallback(Dictionary<Item, int> _changedItems);\n"})}),"\n",(0,a.jsxs)(n.p,{children:["This callback is triggered whenever items within an ",(0,a.jsx)(n.a,{href:"/docs/master-inventory-engine/item-class/item-data",children:"InventoryData"})," are changed. It\u2019s\r\nparticularly useful for monitoring changes in a player's ",(0,a.jsx)(n.strong,{children:"inventory"})," or ",(0,a.jsx)(n.strong,{children:"equipment"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["The callback returns a ",(0,a.jsx)(n.code,{children:"Dictionary"})," where each entry represents an item that has been modified."]}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.strong,{children:"key"})," is the item, and the ",(0,a.jsx)(n.strong,{children:"value"})," indicates the quantity changed. For example:"]}),"\n",(0,a.jsxs)(n.p,{children:["If the player drinks a potion, the ",(0,a.jsx)(n.code,{children:"Dictionary"})," key will be the potion item, and the value will be -1."]}),"\n",(0,a.jsx)(n.p,{children:"If the player loots a sword, the key will be the sword item, and the value will be 1."}),"\n",(0,a.jsx)(n.h5,{id:"to-register-this-callback",children:"TO REGISTER THIS CALLBACK:"}),"\n",(0,a.jsx)(n.p,{children:"First, define the callback function in your script:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:"public void OnEquipmentItemChange(Dictionary<Item, int> _changedItems)  \r\n{ \r\n// Your logic here \r\n} \n"})}),"\n",(0,a.jsxs)(n.p,{children:["In the ",(0,a.jsx)(n.code,{children:"Start"})," method of your script, register the callback:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:"GameManager.PlayerEquipmentData.RegisterItemChangeCallback(OnEquipmentItemChange); \n"})}),"\n",(0,a.jsxs)(n.p,{children:["Remember to ",(0,a.jsx)(n.strong,{children:"UNREGISTER"})," the callback in ",(0,a.jsx)(n.code,{children:"OnDestroy"})," to avoid memory leaks when the ",(0,a.jsx)(n.code,{children:"GameObject"})," is destroyed:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:"GameManager.PlayerEquipmentData.UnRegisterItemChangeCallback(OnEquipmentItemChange);\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Here is a full ",(0,a.jsx)(n.strong,{children:"EXAMPLE"})," of how you could use this callback to change player\u2019s equipment model:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:"private void Start(){\r\n    GameManager.PlayerEquipmentData.RegisterItemChangeCallback(OnEuqipmentItemChange);//Register callback for player's equipment\r\n}\r\n\r\npublic void OnEuqipmentItemChange(Dictionary<Item, int> _changedItems){\r\n    foreach (var _item in _changedItems.Keys) {\r\n        if (_changedItems[_item] > 0) //Equip\r\n        {\r\n            //your logic to read the _item information and change the equipment model.\r\n        }\r\n        else //Unequip\r\n        {\r\n            //your logic to read the _item information and change the equipment model.\r\n        }\r\n    }\r\n}\r\n\r\nprivate void OnDestroy(){\r\n    GameManager.PlayerEquipmentData.UnRegisterItemChangeCallback(OnEuqipmentItemChange);\r\n}\r\n\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h3,{id:"itemdropcallback",children:"ItemDropCallback"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:"public delegate void ItemDropCallback(Item _droppedItem, int _number);\n"})}),"\n",(0,a.jsxs)(n.p,{children:["This callback is triggered whenever items within an ",(0,a.jsx)(n.a,{href:"/docs/master-inventory-engine/item-class/item-data",children:"InventoryData"})," are dropped by dragging out of the window. It\u2019s particularly useful for instantiate item prefabs in the game world when player drop an item."]}),"\n",(0,a.jsxs)(n.p,{children:["The callback returns an ",(0,a.jsx)(n.a,{href:"/docs/master-inventory-engine/item-class/item",children:"Item"})," that has been dropped and its amount. The _droppedItem is the ",(0,a.jsx)(n.a,{href:"/docs/master-inventory-engine/item-class/item",children:"Item"}),", and the _number indicates the amount of this item has been dropped. For example:"]}),"\n",(0,a.jsx)(n.p,{children:"If the player drops 10 potion, the _droppedItem will be the potion item, and the _number will be 10."}),"\n",(0,a.jsx)(n.h5,{id:"to-register-this-callback-1",children:"TO REGISTER THIS CALLBACK:"}),"\n",(0,a.jsx)(n.p,{children:"First, define the callback function in your script:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:"public void OnItemDrop(Item _droppedItem,int _number)  \r\n{ \r\n// Your logic here \r\n} \n"})}),"\n",(0,a.jsxs)(n.p,{children:["In the ",(0,a.jsx)(n.code,{children:"Start"})," method of your script, register the callback:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:"ItemObject.PlayerInventoryData.RegisterItemDropCallback(OnItemDrop);\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Remember to ",(0,a.jsx)(n.strong,{children:"UNREGISTER"})," the callback in ",(0,a.jsx)(n.code,{children:"OnDestroy"})," to avoid memory leaks when the ",(0,a.jsx)(n.code,{children:"GameObject"})," is destroyed:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:"`ItemObject.PlayerInventoryData.UnRegisterItemDropCallback(OnItemDrop);\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h3,{id:"itemusecallback",children:"ItemUseCallback"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:"public delegate void ItemUseCallback(string _action, int _id, int _index);\n"})}),"\n",(0,a.jsx)(n.p,{children:"This callback is triggered whenever the player uses an item, which could be a consumable, equipment, or skill."}),"\n",(0,a.jsx)(n.p,{children:"The callback provides three pieces of information:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"_action"}),": The ",(0,a.jsx)(n.strong,{children:"Use Action"})," string defined in the ",(0,a.jsx)(n.strong,{children:"ItemObject"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"_id"}),": The unique ID of the item."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"_index"}),": The slot index of the item within its container (e.g., inventory)."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"EXAMPLE"}),": In the demo scene setup, if the player drinks a ",(0,a.jsx)(n.strong,{children:"Health Potion (L)"})," located in the 4th slot of the inventory:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"_action"})," will be ",(0,a.jsx)(n.strong,{children:"AddHp_200"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"_id"})," will be 1"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"_index"})," will be 4"]}),"\n"]}),"\n",(0,a.jsx)(n.h5,{id:"to-register-this-callback-2",children:"TO REGISTER THIS CALLBACK:"}),"\n",(0,a.jsx)(n.p,{children:"First, define the callback function in your script:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:"public void OnItemUse(string _action, int _id, int _index)  \r\n{ \r\n// Your logic here \r\n} \n"})}),"\n",(0,a.jsxs)(n.p,{children:["In the ",(0,a.jsx)(n.code,{children:"Start"})," method of your script, register the callback:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:"ItemObject.PlayerInventoryData.RegisterItemUseCallback(OnItemUse)\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Remember to ",(0,a.jsx)(n.strong,{children:"UNREGISTER"})," the callback in ",(0,a.jsx)(n.code,{children:"OnDestroy"})," to avoid memory leaks when the ",(0,a.jsx)(n.code,{children:"GameObject"})," is destroyed:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:"ItemObject.PlayerInventoryData.UnRegisterItemUseCallback(OnItemUse);\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Here is a full ",(0,a.jsx)(n.strong,{children:"EXAMPLE"})," of how you could use this callback to add player\u2019s hp when player drink potion:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'private void Start(){\r\n    GameManager.PlayerInventoryData.RegisterItemUseCallback(OnItemUse);//Register callback to trigger when player\'s item being used.\r\n}\r\n\r\npublic void OnItemUse(string _action, int _id, int _index){ //When player using an item, this callback will be called.\r\n     string _args = _action.Split("_"); \r\n     //For example, the _action of the potion is `AddHp_200`, which  will split int `AddHp` and `200`.\r\n     if(_args.Length>=2){\r\n         int _value=0;\r\n         int.TryParse(_args[1],out _value);\r\n         switch(_args[0]){ // Check the action name and excute corresponding logic.\r\n            case "AddHp":\r\n               Player.AddHealth(_value); //Your logic of adding hp for player.\r\n            break;\r\n            case "AddMp":\r\n               Player.AddMagic(_value); //Your logic of adding mp for player.\r\n            break;\r\n         }\r\n     }\r\n}\r\n\r\nprivate void OnDestroy(){\r\n    GameManager.PlayerInventoryData.UnRegisterItemUseCallback(OnItemUse);\r\n}\n'})}),"\n",(0,a.jsx)(n.hr,{})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>l,x:()=>s});var t=r(6540);const a={},i=t.createContext(a);function l(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);